<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Planner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="planner">
        <div class="sidebar">
            <h2 class="sidebar-title">Days</h2>
            <ul class="sidebar-nav">
                <li><a href="#monday" class="nav-link" onclick="closeSidebar()">Monday</a></li>
                <li><a href="#tuesday" class="nav-link" onclick="closeSidebar()">Tuesday</a></li>
                <li><a href="#wednesday" class="nav-link" onclick="closeSidebar()">Wednesday</a></li>
                <li><a href="#thursday" class="nav-link" onclick="closeSidebar()">Thursday</a></li>
                <li><a href="#friday" class="nav-link" onclick="closeSidebar()">Friday</a></li>
                <li><a href="#saturday" class="nav-link" onclick="closeSidebar()">Saturday</a></li>
                <li><a href="#sunday" class="nav-link" onclick="closeSidebar()">Sunday</a></li>
            </ul>
            <button class="sidebar-toggle" aria-label="Toggle sidebar"><i class="fas fa-bars"></i></button>
        </div>
        <div class="main-content">
            <h1 class="planner-title">Weekly Planner</h1>
            <div class="summary">
                <div class="summary-item">
                    <span>Total Tasks:</span>
                    <span id="total-tasks">0</span>
                </div>
                <div class="summary-item">
                    <span>Completed:</span>
                    <span id="completed-tasks">0</span>
                </div>
                <div class="summary-item">
                    <span>Overdue:</span>
                    <span id="overdue-tasks">0</span>
                </div>
            </div>
            <div class="filter-sort">
                <div class="search-bar">
                    <input type="text" id="search-tasks" placeholder="Search tasks..." aria-label="Search tasks" oninput="searchTasks()">
                    <i class="fas fa-search search-icon"></i>
                </div>
                <label for="filter-tasks"><i class="fas fa-filter"></i> Filter:</label>
                <select id="filter-tasks" onchange="filterTasks()" aria-label="Filter tasks">
                    <option value="all">All</option>
                    <option value="completed">Completed</option>
                    <option value="incomplete">Incomplete</option>
                </select>
                <button onclick="sortTasks()" aria-label="Sort tasks alphabetically"><i class="fas fa-sort-alpha-down"></i> Sort</button>
            </div>
            <div class="days-grid">
                <div class="day-card" id="monday">
                    <div class="day-header">Monday</div>
                    <div class="progress-bar"><div class="progress-fill" id="monday-progress"></div></div>
                    <div class="task-list" id="monday-tasks"></div>
                    <div class="day-actions">
                        <button class="add-task-btn" onclick="showTaskModal('monday')" aria-label="Add task for Monday"><i class="fas fa-plus"></i> Add Task</button>
                        <button class="clear-tasks-btn" onclick="clearTasks('monday')" aria-label="Clear all tasks for Monday"><i class="fas fa-trash-alt"></i> Clear All</button>
                    </div>
                </div>
                <div class="day-card" id="tuesday">
                    <div class="day-header">Tuesday</div>
                    <div class="progress-bar"><div class="progress-fill" id="tuesday-progress"></div></div>
                    <div class="task-list" id="tuesday-tasks"></div>
                    <div class="day-actions">
                        <button class="add-task-btn" onclick="showTaskModal('tuesday')" aria-label="Add task for Tuesday"><i class="fas fa-plus"></i> Add Task</button>
                        <button class="clear-tasks-btn" onclick="clearTasks('tuesday')" aria-label="Clear all tasks for Tuesday"><i class="fas fa-trash-alt"></i> Clear All</button>
                    </div>
                </div>
                <div class="day-card" id="wednesday">
                    <div class="day-header">Wednesday</div>
                    <div class="progress-bar"><div class="progress-fill" id="wednesday-progress"></div></div>
                    <div class="task-list" id="wednesday-tasks"></div>
                    <div class="day-actions">
                        <button class="add-task-btn" onclick="showTaskModal('wednesday')" aria-label="Add task for Wednesday"><i class="fas fa-plus"></i> Add Task</button>
                        <button class="clear-tasks-btn" onclick="clearTasks('wednesday')" aria-label="Clear all tasks for Wednesday"><i class="fas fa-trash-alt"></i> Clear All</button>
                    </div>
                </div>
                <div class="day-card" id="thursday">
                    <div class="day-header">Thursday</div>
                    <div class="progress-bar"><div class="progress-fill" id="thursday-progress"></div></div>
                    <div class="task-list" id="thursday-tasks"></div>
                    <div class="day-actions">
                        <button class="add-task-btn" onclick="showTaskModal('thursday')" aria-label="Add task for Thursday"><i class="fas fa-plus"></i> Add Task</button>
                        <button class="clear-tasks-btn" onclick="clearTasks('thursday')" aria-label="Clear all tasks for Thursday"><i class="fas fa-trash-alt"></i> Clear All</button>
                    </div>
                </div>
                <div class="day-card" id="friday">
                    <div class="day-header">Friday</div>
                    <div class="progress-bar"><div class="progress-fill" id="friday-progress"></div></div>
                    <div class="task-list" id="friday-tasks"></div>
                    <div class="day-actions">
                        <button class="add-task-btn" onclick="showTaskModal('friday')" aria-label="Add task for Friday"><i class="fas fa-plus"></i> Add Task</button>
                        <button class="clear-tasks-btn" onclick="clearTasks('friday')" aria-label="Clear all tasks for Friday"><i class="fas fa-trash-alt"></i> Clear All</button>
                    </div>
                </div>
                <div class="day-card" id="saturday">
                    <div class="day-header">Saturday</div>
                    <div class="progress-bar"><div class="progress-fill" id="saturday-progress"></div></div>
                    <div class="task-list" id="saturday-tasks"></div>
                    <div class="day-actions">
                        <button class="add-task-btn" onclick="showTaskModal('saturday')" aria-label="Add task for Saturday"><i class="fas fa-plus"></i> Add Task</button>
                        <button class="clear-tasks-btn" onclick="clearTasks('saturday')" aria-label="Clear all tasks for Saturday"><i class="fas fa-trash-alt"></i> Clear All</button>
                    </div>
                </div>
                <div class="day-card" id="sunday">
                    <div class="day-header">Sunday</div>
                    <div class="progress-bar"><div class="progress-fill" id="sunday-progress"></div></div>
                    <div class="task-list" id="sunday-tasks"></div>
                    <div class="day-actions">
                        <button class="add-task-btn" onclick="showTaskModal('sunday')" aria-label="Add task for Sunday"><i class="fas fa-plus"></i> Add Task</button>
                        <button class="clear-tasks-btn" onclick="clearTasks('sunday')" aria-label="Clear all tasks for Sunday"><i class="fas fa-trash-alt"></i> Clear All</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="task-modal" id="task-modal">
        <div class="modal-content">
            <h2 id="modal-title">Add New Task</h2>
            <input type="text" id="task-input" placeholder="Enter task description" aria-label="Task description">
            <div class="modal-field">
                <label for="task-category">Category:</label>
                <select id="task-category" aria-label="Select task category">
                    <option value="Work">Work</option>
                    <option value="Personal">Personal</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="modal-field">
                <label for="task-priority">Priority:</label>
                <select id="task-priority" aria-label="Select task priority">
                    <option value="High">High</option>
                    <option value="Medium">Medium</option>
                    <option value="Low">Low</option>
                </select>
            </div>
            <div class="modal-field">
                <label for="task-due-date">Due Date:</label>
                <input type="date" id="task-due-date" aria-label="Select task due date">
            </div>
            <div class="modal-buttons">
                <button id="modal-confirm" onclick="addTaskFromModal()" aria-label="Confirm task addition"><i class="fas fa-check"></i> Add</button>
                <button onclick="closeTaskModal()" aria-label="Cancel task addition"><i class="fas fa-times"></i> Cancel</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
    </div>

    <script>
        let currentDay = '';
        let editTaskElement = null;
        let isSortAscending = true;
        const daysOfWeek = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];

        // Show loading overlay
        function showLoading() {
            document.getElementById('loading-overlay').style.display = 'flex';
        }

        // Hide loading overlay
        function hideLoading() {
            document.getElementById('loading-overlay').style.display = 'none';
        }

        // Highlight today's day
        function highlightToday() {
            const today = new Date().getDay(); // 0 (Sunday) to 6 (Saturday)
            const todayDay = daysOfWeek[today];
            const todayCard = document.getElementById(todayDay);
            if (todayCard) {
                todayCard.classList.add('today');
            }
        }

        // Update summary statistics
        function updateSummary() {
            const days = daysOfWeek;
            let totalTasks = 0;
            let completedTasks = 0;
            let overdueTasks = 0;
            const today = new Date();

            days.forEach(day => {
                const tasks = JSON.parse(localStorage.getItem(`tasks-${day}`)) || [];
                totalTasks += tasks.length;
                completedTasks += tasks.filter(task => task.completed).length;
                overdueTasks += tasks.filter(task => {
                    if (task.completed) return false;
                    const dueDate = task.dueDate ? new Date(task.dueDate) : null;
                    return dueDate && dueDate < today;
                }).length;
            });

            document.getElementById('total-tasks').textContent = totalTasks;
            document.getElementById('completed-tasks').textContent = completedTasks;
            document.getElementById('overdue-tasks').textContent = overdueTasks;
        }

        // Load tasks from localStorage and update progress
        function loadTasks() {
            const days = daysOfWeek;
            days.forEach(day => {
                const tasks = JSON.parse(localStorage.getItem(`tasks-${day}`)) || [];
                const taskList = document.getElementById(`${day}-tasks`);
                taskList.innerHTML = '';
                tasks.forEach(task => {
                    const taskItem = document.createElement('div');
                    taskItem.className = `task-item priority-${task.priority.toLowerCase()}`;
                    taskItem.setAttribute('data-category', task.category);
                    taskItem.setAttribute('data-due-date', task.dueDate || '');
                    const today = new Date();
                    const dueDate = task.dueDate ? new Date(task.dueDate) : null;
                    const isOverdue = dueDate && dueDate < today && !task.completed;
                    if (isOverdue) taskItem.classList.add('overdue');
                    taskItem.innerHTML = `
                        <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} aria-label="Mark task ${task.text} as complete" onchange="updateTaskStatus('${day}', this)">
                        <span>${task.text} <small>(${task.category})</small>${task.dueDate ? ` <small>Due: ${task.dueDate}</small>` : ''}</span>
                        <button class="edit-btn" onclick="editTask(this, '${day}')" aria-label="Edit task ${task.text}"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteTask(this, '${day}')" aria-label="Delete task ${task.text}"><i class="fas fa-trash"></i></button>
                    `;
                    taskList.appendChild(taskItem);
                });
                updateProgress(day);
            });
            updateSummary();
        }

        // Save tasks to localStorage
        function saveTasks(day) {
            const taskList = document.getElementById(`${day}-tasks`);
            const tasks = Array.from(taskList.children).map(item => ({
                text: item.querySelector('span').childNodes[0].textContent.trim(),
                completed: item.querySelector('.task-checkbox').checked,
                category: item.getAttribute('data-category'),
                priority: item.classList.contains('priority-high') ? 'High' : item.classList.contains('priority-medium') ? 'Medium' : 'Low',
                dueDate: item.getAttribute('data-due-date') || ''
            }));
            localStorage.setItem(`tasks-${day}`, JSON.stringify(tasks));
            updateProgress(day);
            updateSummary();
        }

        // Update progress bar for a day
        function updateProgress(day) {
            const taskList = document.getElementById(`${day}-tasks`);
            const tasks = Array.from(taskList.children);
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(task => task.querySelector('.task-checkbox').checked).length;
            const progressPercent = totalTasks === 0 ? 0 : (completedTasks / totalTasks) * 100;
            document.getElementById(`${day}-progress`).style.width = `${progressPercent}%`;
        }

        // Show task modal
        function showTaskModal(day, isEdit = false, task = null) {
            currentDay = day;
            editTaskElement = isEdit ? task : null;
            document.getElementById('task-modal').style.display = 'flex';
            document.getElementById('task-modal').classList.add('active');
            if (isEdit && task) {
                document.getElementById('task-input').value = task.text;
                document.getElementById('task-category').value = task.category;
                document.getElementById('task-priority').value = task.priority;
                document.getElementById('task-due-date').value = task.dueDate || '';
            } else {
                document.getElementById('task-input').value = '';
                document.getElementById('task-category').value = 'Work';
                document.getElementById('task-priority').value = 'Medium';
                document.getElementById('task-due-date').value = '';
            }
            document.getElementById('modal-title').textContent = isEdit ? 'Edit Task' : 'Add New Task';
            document.getElementById('modal-confirm').innerHTML = `<i class="fas fa-check"></i> ${isEdit ? 'Save' : 'Add'}`;
            document.getElementById('task-input').focus();
        }

        // Close task modal
        function closeTaskModal() {
            document.getElementById('task-modal').style.display = 'none';
            document.getElementById('task-modal').classList.remove('active');
            document.getElementById('task-input').value = '';
            document.getElementById('task-category').value = 'Work';
            document.getElementById('task-priority').value = 'Medium';
            document.getElementById('task-due-date').value = '';
            editTaskElement = null;
        }

        // Add or edit task from modal
        function addTaskFromModal() {
            showLoading();
            setTimeout(() => {
                const taskText = document.getElementById('task-input').value;
                const taskCategory = document.getElementById('task-category').value;
                const taskPriority = document.getElementById('task-priority').value;
                const taskDueDate = document.getElementById('task-due-date').value;
                if (taskText) {
                    const taskList = document.getElementById(`${currentDay}-tasks`);
                    const today = new Date();
                    const dueDate = taskDueDate ? new Date(taskDueDate) : null;
                    const isOverdue = dueDate && dueDate < today;

                    if (editTaskElement) {
                        // Edit existing task
                        const taskItem = editTaskElement;
                        taskItem.className = `task-item priority-${taskPriority.toLowerCase()}${isOverdue ? ' overdue' : ''}`;
                        taskItem.setAttribute('data-category', taskCategory);
                        taskItem.setAttribute('data-due-date', taskDueDate);
                        taskItem.querySelector('span').innerHTML = `${taskText} <small>(${taskCategory})</small>${taskDueDate ? ` <small>Due: ${taskDueDate}</small>` : ''}`;
                        taskItem.setAttribute('aria-label', `Mark task ${taskText} as complete`);
                        saveTasks(currentDay);
                    } else {
                        // Add new task
                        const taskItem = document.createElement('div');
                        taskItem.className = `task-item priority-${taskPriority.toLowerCase()}${isOverdue ? ' overdue' : ''}`;
                        taskItem.setAttribute('data-category', taskCategory);
                        taskItem.setAttribute('data-due-date', taskDueDate);
                        taskItem.style.opacity = '0';
                        taskItem.innerHTML = `
                            <input type="checkbox" class="task-checkbox" aria-label="Mark task ${taskText} as complete" onchange="updateTaskStatus('${currentDay}', this)">
                            <span>${taskText} <small>(${taskCategory})</small>${taskDueDate ? ` <small>Due: ${taskDueDate}</small>` : ''}</span>
                            <button class="edit-btn" onclick="editTask(this, '${currentDay}')" aria-label="Edit task ${taskText}"><i class="fas fa-edit"></i></button>
                            <button class="delete-btn" onclick="deleteTask(this, '${currentDay}')" aria-label="Delete task ${taskText}"><i class="fas fa-trash"></i></button>
                        `;
                        taskList.appendChild(taskItem);
                        setTimeout(() => {
                            taskItem.style.opacity = '1';
                            taskItem.style.transform = 'translateY(0)';
                        }, 10);
                        saveTasks(currentDay);
                    }
                    closeTaskModal();
                    filterTasks();
                    searchTasks();
                }
                hideLoading();
            }, 500);
        }

        // Edit task
        function editTask(button, day) {
            editTaskElement = button.parentElement;
            const taskText = editTaskElement.querySelector('span').childNodes[0].textContent.trim();
            const taskCategory = editTaskElement.getAttribute('data-category');
            const taskPriority = editTaskElement.classList.contains('priority-high') ? 'High' :
                                 editTaskElement.classList.contains('priority-medium') ? 'Medium' : 'Low';
            const taskDueDate = editTaskElement.getAttribute('data-due-date') || '';
            showTaskModal(day, true, { text: taskText, category: taskCategory, priority: taskPriority, dueDate: taskDueDate });
        }

        // Delete task
        function deleteTask(button, day) {
            if (confirm('Are you sure you want to delete this task?')) {
                showLoading();
                setTimeout(() => {
                    button.parentElement.remove();
                    saveTasks(day);
                    filterTasks();
                    searchTasks();
                    hideLoading();
                }, 500);
            }
        }

        // Clear all tasks for a day
        function clearTasks(day) {
            if (confirm(`Are you sure you want to clear all tasks for ${day.charAt(0).toUpperCase() + day.slice(1)}?`)) {
                showLoading();
                setTimeout(() => {
                    const taskList = document.getElementById(`${day}-tasks`);
                    taskList.innerHTML = '';
                    saveTasks(day);
                    filterTasks();
                    searchTasks();
                    hideLoading();
                }, 500);
            }
        }

        // Update task status
        function updateTaskStatus(day, checkbox) {
            showLoading();
            setTimeout(() => {
                const taskItem = checkbox.parentElement;
                const today = new Date();
                const dueDate = taskItem.getAttribute('data-due-date') ? new Date(taskItem.getAttribute('data-due-date')) : null;
                const isOverdue = dueDate && dueDate < today && !checkbox.checked;
                taskItem.classList.toggle('overdue', isOverdue);
                saveTasks(day);
                filterTasks();
                searchTasks();
                hideLoading();
            }, 500);
        }

        // Filter tasks
        function filterTasks() {
            const filter = document.getElementById('filter-tasks').value;
            const days = daysOfWeek;
            days.forEach(day => {
                const taskList = document.getElementById(`${day}-tasks`);
                Array.from(taskList.children).forEach(taskItem => {
                    const isCompleted = taskItem.querySelector('.task-checkbox').checked;
                    const matchesSearch = taskItem.style.display !== 'none'; // Respect search visibility
                    if (!matchesSearch) return;
                    if (filter === 'all') {
                        taskItem.style.display = 'flex';
                    } else if (filter === 'completed' && !isCompleted) {
                        taskItem.style.display = 'none';
                    } else if (filter === 'incomplete' && isCompleted) {
                        taskItem.style.display = 'none';
                    } else {
                        taskItem.style.display = 'flex';
                    }
                });
                updateProgress(day);
            });
            updateSummary();
        }

        // Search tasks
        function searchTasks() {
            const searchQuery = document.getElementById('search-tasks').value.toLowerCase();
            const days = daysOfWeek;
            days.forEach(day => {
                const taskList = document.getElementById(`${day}-tasks`);
                Array.from(taskList.children).forEach(taskItem => {
                    const taskText = taskItem.querySelector('span').childNodes[0].textContent.toLowerCase();
                    taskItem.style.display = taskText.includes(searchQuery) ? 'flex' : 'none';
                });
                updateProgress(day);
            });
            filterTasks();
        }

        // Sort tasks
        function sortTasks() {
            const days = daysOfWeek;
            days.forEach(day => {
                const taskList = document.getElementById(`${day}-tasks`);
                const tasks = Array.from(taskList.children);
                tasks.sort((a, b) => {
                    const textA = a.querySelector('span').childNodes[0].textContent.toLowerCase();
                    const textB = b.querySelector('span').childNodes[0].textContent.toLowerCase();
                    return isSortAscending ? textA.localeCompare(textB) : textB.localeCompare(textA);
                });
                taskList.innerHTML = '';
                tasks.forEach(task => taskList.appendChild(task));
                saveTasks(day);
            });
            isSortAscending = !isSortAscending;
            const sortButton = document.querySelector('.filter-sort button');
            sortButton.innerHTML = `<i class="fas ${isSortAscending ? 'fa-sort-alpha-down' : 'fa-sort-alpha-up'}"></i> Sort`;
            filterTasks();
            searchTasks();
        }

        // Close sidebar
        function closeSidebar() {
            document.querySelector('.sidebar').classList.remove('active');
        }

        // Sidebar toggle for mobile
        document.querySelector('.sidebar-toggle').addEventListener('click', () => {
            document.querySelector('.sidebar').classList.toggle('active');
        });

        // Keyboard navigation for modal
        document.getElementById('task-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addTaskFromModal();
        });

        // Load tasks on page load
        window.onload = () => {
            loadTasks();
            highlightToday();
        };
    </script>
</body>
</html>